import{g as se,p as de,aw as xe,q as ce,ax as be,c as g,v as P,s as we,d as ke,o as Pe,w as Q,b as Ce,A as ve,ay as he,az as le,aA as Se,L as o,P as Y,aB as Fe,aC as Re,M as K,ai as oe,aD as Ae,aE as Ie,aF as me,aG as $e,aH as Me,Q as Z,a as De,a9 as qe,aI as Te,r as Ue,aJ as Oe,aK as re,aL as Be,aM as Ne,ak as ze,S as Ee,W as He,aN as Ge,a8 as Le,_ as We,X as je,$ as ie,Y as u,a6 as _,a4 as S,aO as Qe,aP as Je,a7 as X,a3 as T,a2 as Ke,am as Xe,a5 as Ye,V as Ze,al as _e,aQ as ee,aR as et,a0 as i,aS as tt,aT as at,aU as lt,aV as ot,aW as rt}from"./index-DhmPxDvU.js";import{c as it,a as U,b as nt,d as ut,u as st,e as A,V as dt}from"./index.esm-DnAN0w9M.js";import{b as ne}from"./route-block-B_A1xBdJ.js";import{a as ct,b as ue,V as vt}from"./VRow-BMljVhGm.js";import{V as mt}from"./VDivider-D1v1YBr1.js";import{V as ft}from"./VDataTable-Be3UQivP.js";import{V as pt}from"./VToolbar-JFxVWhAM.js";import{V as J}from"./VSelect-B6CKsqM_.js";import{V as gt}from"./VCheckbox-CpPZyvzL.js";import"./VPagination-BIz9N4Sg.js";import"./VCheckboxBtn-3-QdF1hE.js";import"./VList-Bu75zoQN.js";import"./VMenu-BwVogdmA.js";const Vt=de({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Me(),...$e()},"VTextarea"),yt=se()({name:"VTextarea",directives:{Intersect:xe},inheritAttrs:!1,props:Vt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,r){let{attrs:x,emit:w,slots:f}=r;const d=ce(e,"modelValue"),{isFocused:C,focus:M,blur:p}=be(e),O=g(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),B=g(()=>{if(x.maxlength)return x.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function L(n,y){var c,v;!e.autofocus||!n||(v=(c=y[0].target)==null?void 0:c.focus)==null||v.call(c)}const N=P(),b=P(),D=we(""),V=P(),F=g(()=>e.persistentPlaceholder||C.value||e.active);function I(){var n;V.value!==document.activeElement&&((n=V.value)==null||n.focus()),C.value||M()}function z(n){I(),w("click:control",n)}function E(n){w("mousedown:control",n)}function H(n){n.stopPropagation(),I(),Z(()=>{d.value="",Te(e["onClick:clear"],n)})}function G(n){var c;const y=n.target;if(d.value=y.value,(c=e.modelModifiers)!=null&&c.trim){const v=[y.selectionStart,y.selectionEnd];Z(()=>{y.selectionStart=v[0],y.selectionEnd=v[1]})}}const k=P(),R=P(+e.rows),W=g(()=>["plain","underlined"].includes(e.variant));ke(()=>{e.autoGrow||(R.value=+e.rows)});function $(){e.autoGrow&&Z(()=>{if(!k.value||!b.value)return;const n=getComputedStyle(k.value),y=getComputedStyle(b.value.$el),c=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),v=k.value.scrollHeight,q=parseFloat(n.lineHeight),j=Math.max(parseFloat(e.rows)*q+c,parseFloat(y.getPropertyValue("--v-input-control-height"))),a=parseFloat(e.maxRows)*q+c||1/0,l=qe(v??0,j,a);R.value=Math.floor((l-c)/q),D.value=De(l)})}Pe($),Q(d,$),Q(()=>e.rows,$),Q(()=>e.maxRows,$),Q(()=>e.density,$);let h;return Q(k,n=>{n?(h=new ResizeObserver($),h.observe(k.value)):h==null||h.disconnect()}),Ce(()=>{h==null||h.disconnect()}),ve(()=>{const n=!!(f.counter||e.counter||e.counterValue),y=!!(n||f.details),[c,v]=he(x),{modelValue:q,...j}=le.filterProps(e),a=Se(e);return o(le,K({ref:N,modelValue:d.value,"onUpdate:modelValue":l=>d.value=l,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":W.value},e.class],style:e.style},c,j,{centerAffix:R.value===1&&!W.value,focused:C.value}),{...f,default:l=>{let{id:m,isDisabled:t,isDirty:s,isReadonly:pe,isValid:ge}=l;return o(Re,K({ref:b,style:{"--v-textarea-control-height":D.value},onClick:z,onMousedown:E,"onClick:clear":H,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},a,{id:m.value,active:F.value||s.value,centerAffix:R.value===1&&!W.value,dirty:s.value||e.dirty,disabled:t.value,focused:C.value,error:ge.value===!1}),{...f,default:Ve=>{let{props:{class:te,...ae}}=Ve;return o(Y,null,[e.prefix&&o("span",{class:"v-text-field__prefix"},[e.prefix]),oe(o("textarea",K({ref:V,class:te,value:d.value,onInput:G,autofocus:e.autofocus,readonly:pe.value,disabled:t.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:I,onBlur:p},ae,v),null),[[Ae("intersect"),{handler:L},null,{once:!0}]]),e.autoGrow&&oe(o("textarea",{class:[te,"v-textarea__sizer"],id:`${ae.id}-sizer`,"onUpdate:modelValue":ye=>d.value=ye,ref:k,readonly:!0,"aria-hidden":"true"},null),[[Ie,d.value]]),e.suffix&&o("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:y?l=>{var m;return o(Y,null,[(m=f.details)==null?void 0:m.call(f,l),n&&o(Y,null,[o("span",null,null),o(Fe,{active:e.persistentCounter||C.value,value:O.value,max:B.value,disabled:e.disabled},f.counter)])])}:void 0})}),me({},N,b,V)}}),xt=de({id:String,text:String,...Be(Ne({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),bt=se()({name:"VTooltip",props:xt(),emits:{"update:modelValue":e=>!0},setup(e,r){let{slots:x}=r;const w=ce(e,"modelValue"),{scopeId:f}=Ue(),d=Oe(),C=g(()=>e.id||`v-tooltip-${d}`),M=P(),p=g(()=>e.location.split(" ").length>1?e.location:e.location+" center"),O=g(()=>e.origin==="auto"||e.origin==="overlap"||e.origin.split(" ").length>1||e.location.split(" ").length>1?e.origin:e.origin+" center"),B=g(()=>e.transition?e.transition:w.value?"scale-transition":"fade-transition"),L=g(()=>K({"aria-describedby":C.value},e.activatorProps));return ve(()=>{const N=re.filterProps(e);return o(re,K({ref:M,class:["v-tooltip",e.class],style:e.style,id:C.value},N,{modelValue:w.value,"onUpdate:modelValue":b=>w.value=b,transition:B.value,absolute:!0,location:p.value,origin:O.value,persistent:!0,role:"tooltip",activatorProps:L.value,_disableGlobalStack:!0},f),{activator:x.activator,default:function(){var F;for(var b=arguments.length,D=new Array(b),V=0;V<b;V++)D[V]=arguments[V];return((F=x.default)==null?void 0:F.call(x,...D))??e.text}})}),me({},M)}}),wt={class:"text-center"},kt={class:"tooltip-content"},fe={__name:"products",setup(e){const{t:r}=Ee(),{apiAuth:x}=Le(),w=He(),f=Ge([]),d=P(""),C=g(()=>[{title:r("product.name"),key:"name",sortable:!0},{title:r("product.image"),key:"image",sortable:!1},{title:r("product.description"),key:"description",sortable:!0},{title:r("product.price"),key:"price",sortable:!0},{title:r("product.category"),key:"category",sortable:!0},{title:r("product.difficulty"),key:"difficulty",sortable:!1},{title:r("product.players"),key:"players",sortable:!1},{title:r("product.location"),key:"location",sortable:!1},{title:r("product.sell"),key:"sell",sortable:!0},{title:r("product.createdAt"),key:"createdAt",sortable:!0},{title:r("product.updatedAt"),key:"updatedAt",sortable:!0},{title:r("adminProduct.edit"),key:"edit",sortable:!1}]),M=async()=>{var a,l;try{const{data:m}=await x.get("/product/all");f.push(...m.result)}catch(m){console.log(m),w({text:r("api."+(((l=(a=m==null?void 0:m.response)==null?void 0:a.data)==null?void 0:l.message)||"unknownError")),snackbarProps:{color:"red"}})}};M();const p=P({open:!1,id:""}),O=a=>{a&&(p.value.id=a._id,V.value.value=a.name,F.value.value=a.price,I.value.value=a.description,z.value.value=a.category,E.value.value=a.sell,H.value.value=a.difficulty,G.value.value=a.players,k.value.value=a.location,R.value.value=a.dressCode),p.value.open=!0},B=()=>{D(),p.value.id="",p.value.open=!1,c.value.deleteFileRecord()},L=it({name:U().required(r("api.productNameRequired")),price:ut().typeError(r("api.productPriceRequired")).required(r("api.productPriceRequired")).min(0,r("api.productPriceTooSmall")),description:U().required(r("api.productDescriptionRequired")),category:U().required(r("api.productCategoryRequired")).oneOf(["硬核推理","情感沈浸","恐怖驚悚","機制陣營","歡樂搞笑","真相還原"],r("api.productCategoryInvalid")),sell:nt().required(r("api.productSellRequired")),difficulty:U().required(r("api.productDifficultyRequired")).oneOf(["新手入門","新手進階","中等難度","中等偏難","高手挑戰"],r("api.productDifficultyInvalid")),players:U().required(r("api.productPlayersRequired")).oneOf(["3人","4人","5人","6人","7人","8人","9人","10人以上"],r("api.productPlayersInvalid")),location:U().required(r("api.productLocationRequired")).oneOf(["台北市","新北市","桃園市","新竹縣/市","台中市","台南市","高雄市"],r("api.productLocationInvalid")),dressCode:U().required(r("api.productDressCodeRequired")).oneOf(["需換裝","不需換裝"],r("api.productDressCodeInvalid"))}),{handleSubmit:N,isSubmitting:b,resetForm:D}=st({validationSchema:L,initialValues:{name:"",price:0,description:"",category:"",sell:!1,difficulty:"",players:"",location:"",dressCode:""}}),V=A("name"),F=A("price"),I=A("description"),z=A("category"),E=A("sell"),H=A("difficulty"),G=A("players"),k=A("location"),R=A("dressCode"),W=g(()=>[{text:"硬核推理",value:"硬核推理"},{text:"情感沈浸",value:"情感沈浸"},{text:"恐怖驚悚",value:"恐怖驚悚"},{text:"機制陣營",value:"機制陣營"},{text:"歡樂搞笑",value:"歡樂搞笑"},{text:"真相還原",value:"真相還原"}]),$=g(()=>[{text:"新手入門",value:"新手入門"},{text:"新手進階",value:"新手進階"},{text:"中等難度",value:"中等難度"},{text:"中等偏難",value:"中等偏難"},{text:"高手挑戰",value:"高手挑戰"}]),h=g(()=>[{text:"3人",value:"3人"},{text:"4人",value:"4人"},{text:"5人",value:"5人"},{text:"6人",value:"6人"},{text:"7人",value:"7人"},{text:"8人",value:"8人"},{text:"9人",value:"9人"},{text:"10人以上",value:"10人以上"}]),n=g(()=>[{text:"台北市",value:"台北市"},{text:"新北市",value:"新北市"},{text:"桃園市",value:"桃園市"},{text:"新竹縣/市",value:"新竹縣/市"},{text:"台中市",value:"台中市"},{text:"台南市",value:"台南市"},{text:"高雄市",value:"高雄市"}]),y=g(()=>[{text:"需換裝",value:"需換裝"},{text:"不需換裝",value:"不需換裝"}]),c=P(null),v=P([]),q=P([]),j=N(async a=>{var l,m,t;if(!((l=v.value[0])!=null&&l.error)){if(p.value.id.length===0&&v.value.length===0){w({text:r("api.productImageRequired"),snackbarProps:{color:"red"}});return}try{const s=new FormData;s.append("name",a.name),s.append("price",a.price),s.append("description",a.description),s.append("category",a.category),s.append("sell",a.sell),s.append("difficulty",a.difficulty),s.append("players",a.players),s.append("location",a.location),s.append("dressCode",a.dressCode),v.value.length>0&&s.append("image",v.value[0].file),p.value.id.length>0?await x.patch("/product/"+p.value.id,s):await x.post("/product",s),f.splice(0,f.length),M(),w({text:r(p.value.id.length>0?"adminProduct.editSuccess":"adminProduct.newSuccess"),snackbarProps:{color:"green"}}),B()}catch(s){console.log(s),w({text:r("api."+(((t=(m=s==null?void 0:s.response)==null?void 0:m.data)==null?void 0:t.message)||"unknownError")),snackbarProps:{color:"red"}})}}});return(a,l)=>{const m=We("VueFileAgent");return ie(),je(Y,null,[o(vt,null,{default:u(()=>[o(ct,null,{default:u(()=>[o(ue,{cols:"12"},{default:u(()=>[_("h1",wt,S(a.$t("nav.adminProducts")),1)]),_:1}),o(mt),o(ue,{cols:"12"},{default:u(()=>[o(ft,{items:f,headers:C.value,search:d.value},{top:u(()=>[o(pt,null,{default:u(()=>[o(X,{"prepend-icon":"mdi-book-edit",onClick:l[0]||(l[0]=t=>O(null))},{default:u(()=>[T(S(a.$t("adminProduct.new")),1)]),_:1}),o(_e),o(ee,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=t=>d.value=t),"prepend-inner-icon":"mdi-magnify",variant:"underlined"},null,8,["modelValue"])]),_:1})]),"item.image":u(({value:t})=>[o(Ze,{src:t,height:"70"},null,8,["src"])]),"item.sell":u(({value:t})=>[t?(ie(),Ke(Ye,{key:0,icon:"mdi-check"})):Xe("",!0)]),"item.createdAt":u(({value:t})=>[T(S(new Date(t).toLocaleDateString()),1)]),"item.updatedAt":u(({value:t})=>[T(S(new Date(t).toLocaleDateString()),1)]),"item.category":u(({value:t})=>[T(S(t),1)]),"item.edit":u(({item:t})=>[o(X,{icon:"mdi-pencil",variant:"text",onClick:s=>O(t)},null,8,["onClick"])]),"item.description":u(({value:t})=>[o(bt,{location:"bottom",style:{"max-width":"900px"}},{activator:u(({props:s})=>[_("span",Qe(Je(s)),S(t.length>20?t.substring(0,20)+"...":t),17)]),default:u(()=>[_("div",kt,S(t),1)]),_:2},1024)]),_:2},1032,["items","headers","search"])]),_:1})]),_:1})]),_:1}),o(rt,{modelValue:p.value.open,"onUpdate:modelValue":l[13]||(l[13]=t=>p.value.open=t),persistent:"","max-width":"600"},{default:u(()=>[o(dt,{disabled:i(b),onSubmit:et(i(j),["prevent"])},{default:u(()=>[o(tt,null,{default:u(()=>[o(at,null,{default:u(()=>[T(S(a.$t(p.value.id?"adminProduct.edit":"adminProduct.new")),1)]),_:1}),o(lt,null,{default:u(()=>[o(ee,{modelValue:i(V).value.value,"onUpdate:modelValue":l[2]||(l[2]=t=>i(V).value.value=t),label:a.$t("product.name"),"error-messages":i(V).errorMessage.value},null,8,["modelValue","label","error-messages"]),o(ee,{modelValue:i(F).value.value,"onUpdate:modelValue":l[3]||(l[3]=t=>i(F).value.value=t),label:a.$t("product.price"),"error-messages":i(F).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","label","error-messages"]),o(J,{modelValue:i(z).value.value,"onUpdate:modelValue":l[4]||(l[4]=t=>i(z).value.value=t),"error-messages":i(z).errorMessage.value,items:W.value,label:a.$t("product.category"),"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items","label"]),o(J,{modelValue:i(H).value.value,"onUpdate:modelValue":l[5]||(l[5]=t=>i(H).value.value=t),"error-messages":i(H).errorMessage.value,items:$.value,label:a.$t("product.difficulty"),"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items","label"]),o(J,{modelValue:i(G).value.value,"onUpdate:modelValue":l[6]||(l[6]=t=>i(G).value.value=t),"error-messages":i(G).errorMessage.value,items:h.value,label:a.$t("product.players"),"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items","label"]),o(J,{modelValue:i(k).value.value,"onUpdate:modelValue":l[7]||(l[7]=t=>i(k).value.value=t),"error-messages":i(k).errorMessage.value,items:n.value,label:a.$t("product.location"),"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items","label"]),o(J,{modelValue:i(R).value.value,"onUpdate:modelValue":l[8]||(l[8]=t=>i(R).value.value=t),"error-messages":i(R).errorMessage.value,items:y.value,label:a.$t("product.dressCode"),"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items","label"]),o(gt,{modelValue:i(E).value.value,"onUpdate:modelValue":l[9]||(l[9]=t=>i(E).value.value=t),label:a.$t("product.onSell"),"error-messages":i(E).errorMessage.value},null,8,["modelValue","label","error-messages"]),o(yt,{modelValue:i(I).value.value,"onUpdate:modelValue":l[10]||(l[10]=t=>i(I).value.value=t),label:a.$t("product.description"),"error-messages":i(I).errorMessage.value},null,8,["modelValue","label","error-messages"]),o(m,{ref_key:"fileAgent",ref:c,modelValue:v.value,"onUpdate:modelValue":l[11]||(l[11]=t=>v.value=t),"raw-model-value":q.value,"onUpdate:rawModelValue":l[12]||(l[12]=t=>q.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":a.$t("fileAgent.helpText"),"error-text":{type:a.$t("fileAgent.errorType"),size:a.$t("fileAgent.errorSize")}},null,8,["modelValue","raw-model-value","help-text","error-text"])]),_:1}),o(ot,null,{default:u(()=>[o(X,{onClick:B},{default:u(()=>[T(S(a.$t("adminProduct.cancel")),1)]),_:1}),o(X,{type:"submit",loading:i(b)},{default:u(()=>[T(S(a.$t("adminProduct.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof ne=="function"&&ne(fe);const Ut=ze(fe,[["__scopeId","data-v-34d52bdc"]]);export{Ut as default};
